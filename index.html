<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Lab Booking System – Editable</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<style>
  body { font-family: Arial, sans-serif; background:#f4f6f8; margin:0; padding:20px; }
  h1 { text-align:center; }

  .section { max-width:1100px; margin:20px auto; background:#fff; padding:15px; border-radius:6px; box-shadow:0 2px 6px rgba(0,0,0,0.1); }

  .editable { cursor: pointer; padding:2px 4px; border-bottom:1px dashed #555; }

  .calendars { display:grid; grid-template-columns:1fr 1fr; gap:30px; max-width:1100px; margin:auto; }
  .calendar { background:white; border-radius:6px; box-shadow:0 2px 6px rgba(0,0,0,0.1); padding:10px; position:relative; }
  .calendar h3 { text-align:center; margin:5px 0; }
  .month-title { text-align:center; font-weight:bold; margin-bottom:5px; }
  .arrow { cursor:pointer; font-weight:bold; padding:0 10px; user-select:none; }

  .days { display:grid; grid-template-columns:repeat(7,1fr); gap:4px; font-size:12px; }
  .day-header { text-align:center; font-weight:bold; }
  .day { height:70px; border:1px solid #ccc; position:relative; cursor:pointer; background-color:transparent; }
  .day.today { border:3px solid #000; }
  .date-number { position:absolute; top:2px; left:4px; font-size:11px; z-index:1; }

  .booking { position:relative; margin-top:2px; font-size:11px; color:white; padding:2px 4px; border-radius:3px; cursor:pointer; background-color:rgba(0,0,0,0.6); }

  .overlay { position:fixed; inset:0; background:rgba(0,0,0,0.4); display:none; z-index:999; }
  .popup { position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); background:white; padding:15px; width:350px; z-index:1000; box-shadow:0 4px 10px rgba(0,0,0,0.3); display:none; }
  .popup label { display:block; margin-top:8px; }
  .error { color:#c0392b; font-size:12px; margin-top:6px; }
</style>
</head>
<body>

<h1>Lab Booking System</h1>

<div class="section">
  <h2>User Management</h2>
  <input type="text" id="newUser" placeholder="Enter user name" />
  <button onclick="addUser()">Add User</button>
  <div id="userList"></div>
</div>

<div class="calendars">
  <div class="calendar">
    <div style="text-align:center; margin-bottom:5px;"><span class="arrow" onclick="changeMonth(-1,0)">&#8592;</span> <span class="month-title" id="monthC1"></span> <span class="arrow" onclick="changeMonth(1,0)">&#8594;</span></div>
    <h3 id="titleC1" class="editable"></h3>
    <div class="days" id="daysC1"></div>
  </div>
  <div class="calendar">
    <div style="text-align:center; margin-bottom:5px;"><span class="arrow" onclick="changeMonth(-1,1)">&#8592;</span> <span class="month-title" id="monthC2"></span> <span class="arrow" onclick="changeMonth(1,1)">&#8594;</span></div>
    <h3 id="titleC2" class="editable"></h3>
    <div class="days" id="daysC2"></div>
  </div>
</div>

<div class="overlay" id="overlay"></div>
<div class="popup" id="popup">
  <h3 id="popupDate"></h3>
  <label>User:
    <select id="userSelect"></select>
  </label>
  <label><input type="radio" name="type" value="day" checked /> Whole day</label>
  <label><input type="radio" name="type" value="hours" /> Specific duration</label>
  <label>From: <input type="time" id="startTime" value="08:00" /></label>
  <label>To: <input type="time" id="endTime" value="18:00" /></label>
  <div class="error" id="error"></div>
  <br/>
  <button onclick="saveBooking()">Save</button>
  <button onclick="deleteBooking()">Delete</button>
  <button onclick="closePopup()">Cancel</button>
</div>

<script>
const STORE = 'labBookings';
let bookings = JSON.parse(localStorage.getItem(STORE) || '{}');
let computers = ['Computer 1','Computer 2'];
let users = [];
let months = [new Date().getMonth(), new Date().getMonth()];
let years = [new Date().getFullYear(), new Date().getFullYear()];
let today = new Date().getDate();
let selectedCell, selectedCompIndex, selectedDate;
const monthNames = ['January','February','March','April','May','June','July','August','September','October','November','December'];
const userColors = {};
const colorPalette = ['#e74c3c','#3498db','#2ecc71','#f1c40f','#9b59b6','#e67e22','#1abc9c','#34495e'];

function addUser(){
  let name = document.getElementById('newUser').value.trim();
  if(!name || users.includes(name)) return;
  users.push(name);
  if(!userColors[name]) userColors[name] = colorPalette[Object.keys(userColors).length % colorPalette.length];
  document.getElementById('newUser').value='';
  renderUserList();
}

function renderUserList(){
  let list = document.getElementById('userList'); list.innerHTML='';
  let sel = document.getElementById('userSelect'); sel.innerHTML='';
  users.forEach(u=>{
    let opt = document.createElement('option'); opt.value=u; opt.textContent=u; sel.appendChild(opt);
    let div = document.createElement('div'); div.textContent=u; list.appendChild(div);
  });
}

function updateComputerLabels(){
  document.getElementById('titleC1').textContent=computers[0];
  document.getElementById('titleC2').textContent=computers[1];
  document.getElementById('monthC1').textContent = monthNames[months[0]] + ' ' + years[0];
  document.getElementById('monthC2').textContent = monthNames[months[1]] + ' ' + years[1];
}

function buildCalendar(containerId, compIndex){
  const container = document.getElementById(containerId); container.innerHTML='';
  ['Mo','Tu','We','Th','Fr','Sa','Su'].forEach(d=>{ let h=document.createElement('div'); h.className='day-header'; h.textContent=d; container.appendChild(h);});
  let first = new Date(years[compIndex],months[compIndex],1).getDay()||7;
  for(let i=1;i<first;i++) container.appendChild(document.createElement('div'));
  let dim = new Date(years[compIndex],months[compIndex]+1,0).getDate();
  for(let d=1;d<=dim;d++){
    let cell=document.createElement('div'); cell.className='day'; 
    if(d===today && months[compIndex]===new Date().getMonth() && years[compIndex]===new Date().getFullYear()) cell.classList.add('today');
    let dateStr=`${years[compIndex]}-${months[compIndex]+1}-${d}`; cell.innerHTML=`<div class='date-number'>${d}</div>`;
    cell.onclick=()=>openPopup(cell,compIndex,dateStr);
    container.appendChild(cell);
    let key=`${dateStr}-${compIndex}`; if(bookings[key]) renderBooking(cell,bookings[key],compIndex);
  }
}

function renderBooking(cell,data,compIndex){
  cell.querySelector('.booking')?.remove();
  let b=document.createElement('div'); b.className='booking';
  let initials = data.user.split(' ').map(n=>n[0].toUpperCase()).join('');
  b.textContent = data.type==='day'?initials:`${initials} ${data.start}-${data.end}`;
  b.style.backgroundColor = userColors[data.user] || 'rgba(0,0,0,0.6)';
  b.onclick=e=>{ e.stopPropagation(); openPopup(cell,compIndex,data.date,data); };
  cell.appendChild(b);
}

function openPopup(cell, compIndex, date, data=null){
  selectedCell=cell; selectedCompIndex=compIndex; selectedDate=date;
  document.getElementById('popupDate').textContent=`${date} – ${computers[compIndex]}`;
  document.getElementById('overlay').style.display='block';
  document.getElementById('popup').style.display='block';
  document.getElementById('error').textContent='';
  let userSelect=document.getElementById('userSelect');
  userSelect.value = data?data.user:'';
  if(data){
    document.querySelector(`input[name='type'][value='${data.type}']`).checked=true;
    document.getElementById('startTime').value=data.start||'08:00';
    document.getElementById('endTime').value=data.end||'18:00';
  } else {
    document.querySelector(`input[name='type'][value='day']`).checked=true;
    document.getElementById('startTime').value='08:00';
    document.getElementById('endTime').value='18:00';
  }
}

function closePopup(){ document.getElementById('popup').style.display='none'; document.getElementById('overlay').style.display='none'; }

function saveBooking(){
  let user=document.getElementById('userSelect').value;
  if(!user){document.getElementById('error').textContent='Select a user'; return;}
  let type=document.querySelector('input[name="type"]:checked').value;
  let start=document.getElementById('startTime').value;
  let end=document.getElementById('endTime').value;
  if(type==='hours' && end<=start){document.getElementById('error').textContent='Invalid time range'; return;}
  let key=`${selectedDate}-${selectedCompIndex}`;
  bookings[key]={user,type,start,end,date:selectedDate};
  localStorage.setItem(STORE, JSON.stringify(bookings));
  renderBooking(selectedCell,bookings[key],selectedCompIndex);
  closePopup();
}

function deleteBooking(){
  let key=`${selectedDate}-${selectedCompIndex}`;
  delete bookings[key];
  localStorage.setItem(STORE, JSON.stringify(bookings));
  selectedCell.querySelector('.booking')?.remove();
  closePopup();
}

function changeMonth(offset, compIndex){
  months[compIndex] += offset;
  if(months[compIndex]>11){months[compIndex]=0; years[compIndex]+=1;}
  if(months[compIndex]<0){months[compIndex]=11; years[compIndex]-=1;}
  updateComputerLabels();
  buildCalendar('daysC1',0);
  buildCalendar('daysC2',1);
}

// Editable computer names directly
document.getElementById('titleC1').onclick = ()=>{ let newName=prompt('Enter name for Computer 1',computers[0]); if(newName){computers[0]=newName; updateComputerLabels();}};
document.getElementById('titleC2').onclick = ()=>{ let newName=prompt('Enter name for Computer 2',computers[1]); if(newName){computers[1]=newName; updateComputerLabels();}};

renderUserList();
updateComputerLabels();
buildCalendar('daysC1',0);
buildCalendar('daysC2',1);
</script>

</body>
</html>
